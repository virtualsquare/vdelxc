.\" Copyright (C) 2023 VirtualSquare. Project Leader: Renzo Davoli
.\"
.\" This is free documentation; you can redistribute it and/or
.\" modify it under the terms of the GNU General Public License,
.\" as published by the Free Software Foundation, either version 2
.\" of the License, or (at your option) any later version.
.\"
.\" This manual is distributed in the hope that it will be useful,
.\" but WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\" GNU General Public License for more details.
.\"
.\" You should have received a copy of the GNU General Public License
.\" along with this program. If not, see <http://www.gnu.org/licenses/>.
.\"
.\" Automatically generated by Pandoc 3.1.11
.\"
.TH "VDELXCD" "1" "December 2024" "VirtualSquare" "General Commands Manual"
.SH NAME
vdelxcd(1) \[en] vde for containers daemon
.SH SYNOPSIS
\f[CB]vdelxcd\f[R] [\f[I]options\f[R]] \f[I]socket\f[R] [\f[I]VNL\f[R]]
.SH DESCRIPTION
\f[CB]vdelxcd\f[R] is the \f[CB]vdelxc\f[R] deamon.
It runs outside the containers and implements the requests for new
interfaces generated by the \f[CB]vdelxcc\f[R] clients.
.PP
\f[I]socket\f[R] is the pathname of the socket that must be accessible
from the client running inside the container (e.g.\ it can be defined in
a directory mounted by the container).
.PP
\f[I]VNL\f[R] is the Virtual Netowrk Locator of the default network.
(see \f[CB]vde_plug(1)\f[R] for the definition of VNL).
A new interface request not specifying a VNL is connected to the default
network.
.PP
\f[CB]vdelxcd\f[R] implements three security models:
.IP \[bu] 2
permissive (no configuration file, no default VNL in the command line).
Any VNL is allowed.
.IP \[bu] 2
pre\-defined network (no configuration file, default VNL defined in the
command line).
The default VNL identifies the only accessible network.
The client can specify no VNL or exactly the same string of the VNL
passed in the command line of the daemon.
.IP \[bu] 2
configured (a configuration file is loaded by the specific option
\f[CB]\-f\f[R]/\f[CB]\-\-rcfile\f[R]).
The configuration file defines which VNLs are allowed and which do not.
(see over the CONFIGURATION FILE section here below).
Default networks can be defined on the command line or in the
configuration file.
When defined in both places the command line option takes precedence.
VNLs defined as default networks are authorized.
.SH OPTIONS
.TP
\f[CB]\-f\f[R] \f[I]conffile\f[R], \f[CB]\-\-rcfile\f[R] \f[I]conffile\f[R]
define the configuration file.
.TP
\f[CB]\-d\f[R], \f[CB]\-\-daemon\f[R]
run in daemon mode.
.TP
\f[CB]\-p\f[R] \f[I]pidfile\f[R], \f[CB]\-\-pidfile\f[R] \f[I]pidfile\f[R]
set the pathname of the file to save daemon\[cq]s pid.
.TP
\f[CB]\-m\f[R], \f[CB]\-\-mode\f[R]
set the permission mode of the communication socket.
.TP
\f[CB]\-v\f[R], \f[CB]\-\-verbose\f[R]
verbose mode: in non daemon mode logs on stderr successful open/close
operations of interfaces.
.SH CONFIGURATION FILE
Each configuration line has two fields separated by blanks or tabs: a
tag and a VNL.
.PP
Lines beginning by \f[CB]#\f[R] are comments.
.PP
\f[CB]vdelxcd\f[R] supports the following tags:
.IP \[bu] 2
\f[CB]default\f[R]: defines the default VNL;
.IP \[bu] 2
\f[CB]allow\f[R]: the VNL is permitted;
.IP \[bu] 2
\f[CB]deny\f[R]: the VNL is denied;
.IP \[bu] 2
\f[CB]pfxallow\f[R]: prefix allow: if the VNL matches a leading
substring of the requested VNL, it is permitted;
.IP \[bu] 2
\f[CB]pfxdeny\f[R]: prefix deny: if the VNL matches a leading substring
of the requested VNL, it is forbidden.
.PP
The authorization process uses the following procedure:
.IP \[bu] 2
if the client does not specify a VNL in its request: the interface is
connected to the VNL specified in the command line if present, otherwise
to the default VNL specified in the configuration file.
If no default VNL has been defined the request fails.
.IP \[bu] 2
the VNL requested by the client is checked against the the authorization
rules of the confuguration file, line by line.
The first line matching the VNL causes the request to be granted (allow)
or forbidden (deny).
If none of the lines matches, the request fails.
.PP
In case of nested VNL (like those of libvdeplug_agno or libvdeplug_vlan)
all the VNLs must be granted.
.SH EXAMPLES
The following configuration file permits to use tap0 or any vxvde
network, the default network is vxvde://234.0.0.1.
The usage of any other plugin is forbidden.
.IP
.EX
default    vxvde://234.0.0.1
pfxallow   vxvde://
allow      tap://tap0
.EE
.PP
An empty VNL as well as \f[CB]vxvde://\f[R] or
\f[CB]vxvde://234.0.0.1\f[R] or
\f[CB]vxvde://ff05:56de::1/port=12345/vni=42\f[R] or
\f[CB]tap://tap0\f[R] are accepted.
Others like \f[CB]null://\f[R] or \f[CB]tap://tap1\f[R] are denied.
.PP
The following configuration file is similar to the previous one, but
allows the definition of vlans or agno cryptography permitting in this
way a VNL like \f[CB]vlan://3{vxvde://224.0.0.2\f[R]:
.IP
.EX
default    vxvde://234.0.0.1
allow      tap://tap0
pfxallow   vxvde://
pfxallow   vlan://
pfxallow   agno://
pfxallow   vxvde://
.EE
.PP
The following configuration file permits any plugin but cmd (that could
allow command execution in the hosting environment):
.IP
.EX
pfxdeny  cmd://
pfxallow
.EE
.PP
The last line, \f[CB]pfxallow\f[R] of an empty prefix, authorizes all
the VNLs not matching any previous deny/pfxdeny rule.
.SH SEE ALSO
vde_plug(1), vdelxcc(1)
.SH AUTHOR
VirtualSquare.
Project leader: Renzo Davoli.
