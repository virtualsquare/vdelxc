<!--
.\" Copyright (C) 2023 VirtualSquare. Project Leader: Renzo Davoli
.\"
.\" This is free documentation; you can redistribute it and/or
.\" modify it under the terms of the GNU General Public License,
.\" as published by the Free Software Foundation, either version 2
.\" of the License, or (at your option) any later version.
.\"
.\" This manual is distributed in the hope that it will be useful,
.\" but WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\" GNU General Public License for more details.
.\"
.\" You should have received a copy of the GNU General Public License
.\" along with this program. If not, see <http://www.gnu.org/licenses/>.
.\"
-->

# NAME
vdelxcd(1) -- vde for containers daemon

# SYNOPSIS

`vdelxcd`  [*options*]  *socket* [*VNL*]

# DESCRIPTION

`vdelxcd` is the `vdelxc` deamon. It runs outside the containers and implements
the requests for new interfaces generated by the `vdelxcc` clients.

*socket* is the pathname of the socket that must be accessible from the
client running inside the container (e.g. it can be defined in a directory mounted by the container).

*VNL* is the Virtual Netowrk Locator of the default network. (see `vde_plug(1)` for the definition of
VNL). A new interface request not specifying a VNL is connected to the default network.

`vdelxcd` implements three security models:

* permissive (no configuration file, no default VNL in the command line). Any VNL is allowed.

* pre-defined network (no configuration file, default VNL defined in the command line). The
default VNL identifies the only accessible network. The client can specify no VNL or exactly the same
string of the VNL passed in the command line of the daemon.

* configured (a configuration file is loaded by the specific option `-f`/`--rcfile`).
The configuration file defines which VNLs are allowed and which do not.
(see over the CONFIGURATION FILE section here below).
Default networks can be defined on the command line or in the configuration file.
When defined in both places the command line option takes precedence.
VNLs defined as default networks are authorized.

# OPTIONS
  `-f` *conffile*, `--rcfile` *conffile*
: define the configuration file.

  `-d`, `--daemon`
: run in daemon mode.

  `-p` *pidfile*, `--pidfile` *pidfile*
: set the pathname of the file to save daemon's pid.

  `-m`, `--mode`
: set the permission mode of the communication socket.

  `-v`, `--verbose`
: verbose mode: in non daemon mode logs on stderr successful open/close operations of interfaces.

# CONFIGURATION FILE

Each configuration line has two fields separated by blanks or tabs: a tag and a VNL.

Lines beginning by `#` are comments.

`vdelxcd` supports the following tags:

* `default`: defines the default VNL;
* `allow`: the VNL is permitted;
* `deny`: the VNL is denied;
* `pfxallow`: prefix allow: if the VNL matches a leading substring of the requested VNL, it is permitted;
* `pfxdeny`: prefix deny:  if the VNL matches a leading substring of the requested VNL, it is forbidden.

The authorization process uses the following procedure:

* if the client does not specify a VNL in its request: the interface is connected to the VNL
specified in the command line if present, otherwise to the default VNL specified in the
configuration file. If no default VNL has been defined the request fails.

* the VNL requested by the client is checked against the the authorization rules of the
confuguration file, line by line.
The first line matching the VNL causes the request to be granted (allow) or forbidden (deny).
If none of the lines matches, the request fails.

In case of nested VNL (like those of libvdeplug\_agno or libvdeplug\_vlan) all the VNLs must be granted.

# EXAMPLES

The following configuration file permits to use any vxvde network, the default network is vxvde://234.0.0.1.
The usage of any other plugin is forbidden.
```
default    vxvde://234.0.0.1
pfxallow   vxvde://
allow      tap://tap0
```

An empty VNL as well as `vxvde://` or `vxvde://234.0.0.1` or `vxvde://ff05:56de::1/port=12345/vni=42` or
`tap://tap0` are
accepted. Others like `null://` or `tap://tap1` are denied.

The following configuration file is similar to the previous one, but allows the definition of vlans or
agno cryptography permitting in this way a VNL like `vlan://3{vxvde://224.0.0.2`:
```
default    vxvde://234.0.0.1
allow      tap://tap0
pfxallow   vxvde://
pfxallow   vlan://
pfxallow   vxvde://
```

The following configuration file permits any plugin but cmd (that could allow command execution
		in the hosting environment):
```
pfxdeny  cmd://
pfxallow
```
The last line, `pfxallow` of an empty prefix, authorizes all the VNLs not matching any previous
deny/pfxdeny rule.

# SEE ALSO
vde\_plug(1), vdelxcc(1)

# AUTHOR
VirtualSquare. Project leader: Renzo Davoli.
